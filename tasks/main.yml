---
- name: INSTALL | Ensure group "vector" exists
  become: true
  ansible.builtin.group:
    name: "{{ vector_group }}"
    state: present

- name: INSTALL | Add the user 'vector' with a bash shell, appending the group 'vector' and groups for scraping
  become: true
  ansible.builtin.user:
    name: "{{ vector_user }}"
    group: "{{ vector_group }}"
    groups: "{{ vector_groups | default('') }}"
    shell: /usr/sbin/nologin
    createhome: true
    append: true

- name: INSTALL | Install Vector rpm from a remote repo
  become: true
  ansible.builtin.yum:
    name: "https://yum.vector.dev/stable/vector-0/{{ ansible_architecture }}/vector-{{ vector_version }}-1.{{ ansible_architecture }}.rpm"
    state: present
  notify: restart vector

- name: CONFIG | Set Vector config from template
  ansible.builtin.template:
    src: vector.j2
    dest: /etc/vector/vector.yaml
    mode: '0755'
  notify: reload vector